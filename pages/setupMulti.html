<!DOCTYPE html>
<html>
<head>
   <title></title>
</head>
<!-- UI Functions -->
<script type="text/javascript">
   function joinMultiplayer(event,obj){
      if (event.key === "Enter") {
         var val = obj.value;
         if(val != ""){
            joinChannel(val);
            document.getElementById("join_id").style.display = "none";
            document.getElementById("exitMultiplayer").style.display = "";
            document.getElementById("hasJoined").style.display = "";
            document.getElementById("hasJoined").innerText = "Joined: "+val+" âœ”";

         }
      }
   }

   function submitUsername(event,obj){
      if (event.key === "Enter") {
         var val = obj.value;
         if(val != ""){
            console.log(val);
            document.username = val;
         }
      }
   }

   function startMultiGame(){
      document.isSinglePlayerGame = false;
      var msg = {
         "board" : document.board,
         "time" : document.endtime,
         "numPlayers" : document.otherPlayers.size + 1
      }
      console.log("start");
      sendMessage(msg,MessageType.initialBoards);
   }
   function changeTimeMulti(change){
      var time = document.setupTime / 60000;

      time += change;
      if(time > 5) time = Math.min(10,time);
      else time = 5;

      setClock(time,0,"clockdiv_setup_multi");

      document.setupTime = time * 60000;
   }

   function toggleHost(isHost){
      document.getElementById("pacman_container").style.display = "";

      // unsubscribe to old seed
      if(document.channel != null){
         unsubscribe(document.channel);
      }

      if(isHost){
         var seed = startChannel();
         document.board = shuffledBoard();
         // document.multiplayerSeed = seed;
         var url = "lmiller36.github.io/Boggle/#/joinGame/"+seed;
         document.getElementById("game_id").innerText = seed;
         document.getElementById("host").style.display = "";
         document.getElementById("join").style.display = "none";
         document.getElementById("game_link").href = 
         document.getElementById("game_link").innerText = url;
         document.getElementById("startGameMultiButton").style.display = "";

      }
      else {
         document.board = null;
         document.getElementById("host").style.display = "none";
         document.getElementById("join").style.display = "";
         document.getElementById("startGameMultiButton").style.display = "none";
      }
   }

   function exitMultiplayerSession(){
      removePlayer(document.me);
      unsubscribe();

      document.getElementById("exitMultiplayer").style.display = "none";
      document.getElementById("join_id").style.display = "";
      document.getElementById("hasJoined").style.display = "none";
   }

   function mainMenu_setupMulti(){
      unsubscribe();

      //TODO Unsubscribe stuff
            // Go to main menu
            toggleVisiblePage(Pages.mainMenu);
         }

      </script>
      <body>
         <div class = "setupMulti">
            <div id = "leftMenu_setup_multi" class="leftSide" style="display: none">
               <i class="fa fa-arrow-circle-left fa-4x icon" onclick="mainMenu_setupMulti()"></i> 
            </div>
            <div class="centerContent">
               <p>Please select one: </p>
               <input id ="isHostRadio" type="radio" name="host" value="1" onchange="toggleHost(true)"> Host<br>
               <input id ="isJoinRadio" type="radio" name="host" value="0" onchange="toggleHost(false)"> Join<br>
            </div>
            <div class="centerContent" id = "username_container">
               <input id="username" style="border-radius: 1px; width: 150px; margin-bottom: 50px;" onkeyup="submitUsername(event,this)" placeholder="username" />
            </div>

            <div id = "host" class="" style = "display: none">
               <div class="centerContent">
                  <div id="clockdiv_setup_multi" class = "timer">
                     <span class="timerFont minutes">05</span>:<span class="timerFont seconds">00</span>
                  </div>
               </div>
               <div class="centerContent">
                  <button onclick="changeTimeMulti(1)">+</button>
                  <button onclick="changeTimeMulti(-1)">-</button>
               </div>
               <div class="centerContent">
                  Game ID: 
                  <p id="game_id"></p>
               </div>
               <div class="centerContent">
                  Share this link: 
               </div>
               <div class="centerContent">
                  <a id="game_link"></a>
               </div>
               <br/>
               <div class="centerContent">
                  <div class="wrap">
                     <table class="joinedPlayersTable">
                        <tr>
                           <td>Joined</td>
                           <td>Remove</td>
                        </tr>
                     </table>
                     <div class="inner_table">
                        <table id="playersList">
                        </table>
                     </div>
                  </div>
               </div>
               <br/>
               <div class="centerContent" id = "startGameMultiButton" style = "display: none">
                  <i class="fa fa-play fa-2x icon" onclick="startMultiGame()"></i> 
               </div>
            </div>   
            <div id = "join" style="" class = "">
               <div class = "centerContent">
                  <input id="join_id" style="border-radius: 1px; width: 150px; margin-bottom: 50px;" onkeyup="joinMultiplayer(event,this)" placeholder="game ID"/>
                  <div>
                     <span id = "hasJoined" style=""></span>
                     <i id ="exitMultiplayer" class=" fa fa-times" style="display: none" onclick="exitMultiplayerSession()"></i>
                  </div>
               </div>
               <br/>
               <p class = "centerContent"><b>Please ask host to start</b></p>
            </div>       
            <div id ="pacman_container"></div>
         </div>
      </body>
      </html>